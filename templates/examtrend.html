{% extends "dashboard.html" %}
{% block content %}

<style>
/* =========================
   GENERAL
========================= */
.dashboard {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    padding: 15px;
    margin-bottom: 20px;
}

h5 {
    font-size: 17px;
    font-weight: 600;
    color: #333;
    border-left: 4px solid #007bff;
    padding-left: 10px;
    margin-top: 25px;
}

/* =========================
   CHART
========================= */
.chart-container {
    width: 100%;
    height: 400px;
}

@media (max-width: 768px) {
    .chart-container {
        height: 250px;
    }
}

/* =========================
   DESKTOP TABLE
========================= */
.desktop-only {
    display: block;
}

.mobile-only {
    display: none;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background-color: #fff;
    border-radius: 10px;
    overflow: hidden;
}

th, td {
    padding: 12px;
}

th {
    background: #007bff;
    color: white;
}

td {
    border-bottom: 1px solid #e9ecef;
}

/* =========================
   MOBILE CARDS
========================= */
.marks-card {
    background: #ffffff;
    border-radius: 12px;
    padding: 15px;
    margin-top: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.marks-card div {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    font-size: 14px;
}

.marks-card hr {
    margin: 10px 0;
}

/* =========================
   MOBILE RULES
========================= */
@media (max-width: 768px) {
    .desktop-only {
        display: none;
    }

    .mobile-only {
        display: block;
    }

    h5 {
        font-size: 16px;
    }
}
</style>

<!-- =========================
     CHART SECTION
========================= -->
<div class="dashboard">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <div class="chart-container">
        <canvas id="studentScoresChart"></canvas>
    </div>
</div>

<script>
const studentScores = {{ exam_scores | safe }};

const terms = [
    'T1 E1','T1 E2','T1 E3',
    'T2 E1','T2 E2','T2 E3',
    'T3 E1','T3 E2','T3 E3'
];

const datasets = Object.keys(studentScores).map(year => ({
    label: `Year ${year}`,
    data: studentScores[year] || Array(9).fill(null),
    borderColor: '#' + Math.floor(Math.random()*16777215).toString(16),
    tension: 0.3
}));

new Chart(document.getElementById('studentScoresChart'), {
    type: 'line',
    data: { labels: terms, datasets },
    options: {
        responsive: true,
        plugins: {
            legend: { position: 'top' },
            title: {
                display: true,
                text: '{{ student_id }} Performance'
            }
        }
    }
});
</script>

<!-- =========================
     RESULTS SECTION
========================= -->
<div class="container">

{% if student_marks %}
{% for marks in range(3) %}

<h5>
    {{ student_marks[marks][1] }} • 
    Term {{ student_marks[marks][2] }} • 
    {{ student_marks[marks][3] }}
</h5>

<!-- ===== DESKTOP TABLE ===== -->
<div class="desktop-only">
<table>
    <thead>
        <tr>
            <th>Subject</th>
            <th>Marks</th>
        </tr>
    </thead>
    <tbody>
        <tr><td>Mathematics</td><td>{{ student_marks[marks][4] }}</td></tr>
        <tr><td>Biology</td><td>{{ student_marks[marks][5] }}</td></tr>
        <tr><td>Chemistry</td><td>{{ student_marks[marks][6] }}</td></tr>
        <tr><td>Physics</td><td>{{ student_marks[marks][7] }}</td></tr>
        <tr><td>Geography</td><td>{{ student_marks[marks][8] }}</td></tr>
        <tr><td>Business</td><td>{{ student_marks[marks][9] }}</td></tr>
        <tr><td>English</td><td>{{ student_marks[marks][10] }}</td></tr>
        <tr><td>Kiswahili</td><td>{{ student_marks[marks][11] }}</td></tr>
        <tr><td>CRE</td><td>{{ student_marks[marks][12] }}</td></tr>
        <tr><td>French</td><td>{{ student_marks[marks][13] }}</td></tr>
        <tr><th>Average</th><th>{{ student_marks[marks][14] }}</th></tr>
    </tbody>
</table>
</div>

<!-- ===== MOBILE CARDS ===== -->
<div class="mobile-only">
<div class="marks-card">
    <div><strong>Mathematics</strong><span>{{ student_marks[marks][4] }}</span></div>
    <div><strong>Biology</strong><span>{{ student_marks[marks][5] }}</span></div>
    <div><strong>Chemistry</strong><span>{{ student_marks[marks][6] }}</span></div>
    <div><strong>Physics</strong><span>{{ student_marks[marks][7] }}</span></div>
    <div><strong>Geography</strong><span>{{ student_marks[marks][8] }}</span></div>
    <div><strong>Business</strong><span>{{ student_marks[marks][9] }}</span></div>
    <div><strong>English</strong><span>{{ student_marks[marks][10] }}</span></div>
    <div><strong>Kiswahili</strong><span>{{ student_marks[marks][11] }}</span></div>
    <div><strong>CRE</strong><span>{{ student_marks[marks][12] }}</span></div>
    <div><strong>French</strong><span>{{ student_marks[marks][13] }}</span></div>
    <hr>
    <div><strong>Average</strong><span>{{ student_marks[marks][14] }}</span></div>
</div>
</div>

{% endfor %}
{% else %}
<p>No examination records found.</p>
{% endif %}

</div>

{% endblock %}
