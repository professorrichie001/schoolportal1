{% extends "dashboard.html" %}
{% block content %}
  <link rel="stylesheet" href="../static/assets/css/styles.min.css" />
    <link rel="stylesheet" href="../static/assets/css/n.css" />
<!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


<!-- =========================
     CHART SECTION
========================= -->
<div class="dashboard">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <div class="chart-container">
        <canvas id="studentScoresChart"></canvas>
    </div>
</div>

<script>
const studentScores = {{ exam_scores | safe }};

const terms = [
    'T1 E1','T1 E2','T1 E3',
    'T2 E1','T2 E2','T2 E3',
    'T3 E1','T3 E2','T3 E3'
];

const datasets = Object.keys(studentScores).map(year => ({
    label: `Year ${year}`,
    data: studentScores[year] || Array(9).fill(null),
    borderColor: '#' + Math.floor(Math.random()*16777215).toString(16),
    tension: 0.3
}));

new Chart(document.getElementById('studentScoresChart'), {
    type: 'line',
    data: { labels: terms, datasets },
    options: {
        responsive: true,
        plugins: {
            legend: { position: 'top' },
            title: {
                display: true,
                text: '{{ student_id }} Performance'
            }
        }
    }
});
</script>

<!-- =========================
     RESULTS SECTION
========================= -->
<div class="container">

{% if student_marks %}
{% for mark_record in student_marks %}

<h5>
    {{ mark_record[1] }} •
    Term {{ mark_record[2] }} •
    {{ mark_record[3] }}
</h5>

<!-- ===== DESKTOP TABLE ===== -->
<div class="desktop-only">
<table>
    <thead>
        <tr>
            <th>Subject</th>
            <th>Marks</th>
        </tr>
    </thead>
    <tbody>
        {% for subject in enrolled_subjects %}
        <tr><td>{{ subject }}</td><td>{{ mark_record[4 + loop.index0] }}</td></tr>
        {% endfor %}
        <tr><th>Average</th><th>{{ mark_record[4 + enrolled_subjects|length] }}</th></tr>
    </tbody>
</table>
</div>

<!-- ===== MOBILE CARDS ===== -->
<div class="mobile-only">
<div class="marks-card">
    {% for subject in enrolled_subjects %}
    <div><strong>{{ subject }}</strong><span>{{ mark_record[4 + loop.index0] }}</span></div>
    {% endfor %}
    <hr>
    <div><strong>Average</strong><span>{{ mark_record[4 + enrolled_subjects|length] }}</span></div>
</div>
</div>

{% endfor %}
{% else %}
<p>No examination records found.</p>
{% endif %}

</div>


<script src="../static/assets/libs/jquery/jquery.min.js"></script>
  <script src="../static/assets/libs/bootstrap.bundle.min.js"></script>
  <script src="../static/assets/js/sidebarmenu.js"></script>
  <script src="../static/assets/js/app.min.js"></script>
  <script src="../static/assets/libs/apexcharts/apexcharts.min.js"></script>
  <script src="../static/assets/libs/simplebar/simplebar.js"></script>
  <script src="../static/assets/js/dashboard.js"></script>
      <script src="/../static/vendor/chart.js/Chart.min.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

{% endblock %}
